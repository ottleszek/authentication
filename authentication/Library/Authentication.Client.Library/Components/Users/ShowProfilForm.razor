@namespace Authentication.Client.Library.Components

@inherits MvvmComponentBase<ProfilViewModel>

@if (string.IsNullOrEmpty(UserEmail))
{
    <MudText>A felhasználó meghatározása még nem sikerült!</MudText>
}
else
{
    <MudBreadcrumbs Items="_items" Separator=">"></MudBreadcrumbs>

    <MudCard>
        @if (ViewModel is null || ! ViewModel.IsValidUser)
        {
            <MudChip Class="pt-2 d-flex justify-content-center" Color="Color.Error">
                <p>>A profil adatok megjelenítése nem lehetséges!</p>
            </MudChip>
        }
        else
        {
            if (Validation is not null)
            {
                <MudForm Model="ViewModel" @ref="_form" Validation="Validation.ValidateValue">
                    <MudCardContent>
                        @if (ViewModel.ErrorString.HasError)
                        {
                            <MudChip class="pt-2 d-flex justify-content-center" Color="Color.Error">
                                <p>@ViewModel.ErrorString.Error</p>
                            </MudChip>
                        }
                        <MudTextField @bind-Value="ViewModel.LastName"
                                        For="@( () => ViewModel.LastName)"
                                        Immediate=true
                                        Required="true"
                                        RequiredError="A vezetéknév szükséges!"
                                        Label="Vezetéknév" 
                                        ReadOnly="@ViewModel.IsReadOnly"
                                        />
                        <MudTextField @bind-Value="ViewModel.FirstName"
                                        For="@( () => ViewModel.FirstName)"
                                        Immediate=true
                                        Required="true"
                                        RequiredError="A keresztnév szükséges!"
                                        Label="Keresztnév"
                                        ReadOnly="@ViewModel.IsReadOnly"
                                        />
                        <MudTextField @bind-Value="ViewModel.Email"
                                        Immediate=true
                                        Required="true"
                                        ReadOnly="true"
                                        Disabled="true"
                                        RequiredError="Az email cím szükséges!"
                                        InputType="InputType.Email"
                                        Label="Email" 
                                        />
                        @if (ViewModel.IsProfilImageExsist)
                        {
                            <MudImage Src="@ViewModel.ProfilImageUrl" Width="200" Height="150" Alt="Profil kép" Elevation="25" Class="rounded-lg ma-4"/>
                        }
                        @if (_canUploadProfilImage)
                        {
                            <UIImageUpload 
                                ButtonText="Profil kép feltöltés"
                                FilePath="@ViewModel.ProfilImageFoleder"
                                FileName="@ViewModel.ProfilImageFileName"
                            >
                             </UIImageUpload>
                        }
                    </MudCardContent>
                    <MudCardActions>
                        @if (ViewModel.IsReadOnly)
                        {
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="ViewModel.ChangeToModify">Módosítom a profilomat</MudButton>
                        }
                        else
                        {
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="UpdateProfil" Disabled="@ViewModel.IsBusy">Mentés</MudButton>
                            <MudButton Class="ml-2" Variant="Variant.Filled" Color="Color.Secondary" OnClick="ViewModel.ChangeToReadOnly" Disabled="@ViewModel.IsBusy">Mégsem</MudButton>
                        }
                    </MudCardActions>
                </MudForm>
            }
        }
    </MudCard>
}
